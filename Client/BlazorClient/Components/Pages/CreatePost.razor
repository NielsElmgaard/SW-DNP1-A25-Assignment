@page "/CreatePost"
@inject IPostService PostService
<h3>Create Post</h3>

@if (!string.IsNullOrEmpty(LastSubmitResult))
{
    <h2 class="alert @(IsSucces ? "alert-success" : "alert-danger")">
        @LastSubmitResult
    </h2>
}
<PostForm Post="Post"
          OnValidSubmit="ValidFormSubmitted"
          OnInvalidSubmit="InvalidFormSubmitted"/>

@code {

    CreatePostDTO Post = new CreatePostDTO
    {
        Title = null,
        Body = null,
        UserId = null
    };

    string LastSubmitResult;
    bool IsSucces;
    PostDTO? CreatedPost;

    async Task ValidFormSubmitted()
    {
        LastSubmitResult = "Submitting post...";
        IsSucces = false;
        try
        {
            CreatedPost = await PostService.CreatePostAsync(Post);

            LastSubmitResult = $"Success! Post created with ID: {CreatedPost.Id}.";
            IsSucces = true;

            Post = new CreatePostDTO // reset
            {
                Title = null,
                Body = null,
                UserId = null
            };
        }
        catch (Exception e)
        {
            LastSubmitResult = $"Server Error: {e.Message}";
            IsSucces = false;
        }
    }

    void InvalidFormSubmitted()
    {
        LastSubmitResult = "Failure! Please correct the highlighted errors.";
        IsSucces = false;
    }

}